<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arah Kiblat</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
  text-align:center;
}

header{
  padding:20px;
  font-size:22px;
  font-weight:bold;
  background:#111827;
}

.container{
  margin-top:40px;
}

.compass{
  width:250px;
  height:250px;
  border:8px solid #22c55e;
  border-radius:50%;
  margin:30px auto;
  position:relative;
}

.arrow{
  width:4px;
  height:110px;
  background:red;
  position:absolute;
  top:15px;
  left:50%;
  transform-origin:bottom center;
  transform:translateX(-50%) rotate(0deg);
}

.degree{
  font-size:18px;
  margin-top:15px;
}

button{
  padding:12px 20px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.footer{
  margin-top:40px;
  font-size:12px;
  opacity:0.6;
}
</style>
</head>

<body>

<header>ðŸ§­ Arah Kiblat</header>

<div class="container">

<button onclick="getLocation()">Aktifkan GPS</button>

<div class="compass">
  <div class="arrow" id="arrow"></div>
</div>

<div class="degree" id="degree">0Â°</div>

</div>

<div class="footer">
Muslim Pro Lite Â© 2026
</div>
<!-- TARUH DI PALING BAWAH SEBELUM </body> -->

<script>

let qiblaDirection = 0;

// Koordinat Ka'bah
const kaabaLat = 21.4225;
const kaabaLon = 39.8262;

// Hitung arah kiblat dari lokasi user
function calculateQibla(lat, lon){
  const toRad = deg => deg * Math.PI/180;
  const toDeg = rad => rad * 180/Math.PI;

  const dLon = toRad(kaabaLon - lon);

  const y = Math.sin(dLon);
  const x = Math.cos(toRad(lat))*Math.tan(toRad(kaabaLat)) -
            Math.sin(toRad(lat))*Math.cos(dLon);

  let brng = toDeg(Math.atan2(y, x));
  return (brng + 360) % 360;
}

// Ambil lokasi user
function initLocation(){
  navigator.geolocation.getCurrentPosition(
    pos=>{
      qiblaDirection = calculateQibla(
        pos.coords.latitude,
        pos.coords.longitude
      );
    },
    err=>{
      alert("GPS tidak aktif");
    }
  );
}

// Aktifkan kompas
function initCompass(){

  if (typeof DeviceOrientationEvent !== "undefined" &&
      typeof DeviceOrientationEvent.requestPermission === "function") {

    DeviceOrientationEvent.requestPermission()
    .then(response=>{
      if(response === "granted"){
        window.addEventListener("deviceorientation", handleOrientation);
      }
    });

  } else {
    window.addEventListener("deviceorientationabsolute", handleOrientation);
    window.addEventListener("deviceorientation", handleOrientation);
  }
}

function handleOrientation(event){

  let heading;

  if(event.absolute === true || event.alpha !== null){
    heading = event.alpha;
  } else {
    return;
  }

  const rotate = qiblaDirection - heading;

  document.getElementById("needle").style.transform =
    "rotate(" + rotate + "deg)";

  document.getElementById("degree").innerText =
    Math.round(heading) + "Â°";
}

// Tombol GPS
function startQibla(){
  initLocation();
  initCompass();
}

</script>
</body>
</html>